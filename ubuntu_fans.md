# Fans Controll for Ubuntu

Prob Alienware alpha to display the fans speed:

```
sudo modprobe dell-smm-hwmon force=1
```

Thins to install:

- lm-sensors
- fanscontrol

When lm-sensors is intalled, run `sudo sensors-detect` first, select YES for all options, and may be reboot.

Then run `sudo pwmconfig` to test sensors and configure fan speed (pwm), after configuration, select save-and-exit.

In this case, we already have configuration setup, we run `sudo fancontrol` to actually apply the control of fans.

Run `sudo systemctl enable fancontrol` to enable fancontrol as service.

~~To always probe the module dell-smm-hwmon on startup, create file `/etc/modules-load.d/dell-smm-hwmon.conf` with content: `dell-smm-hwmon`~~(this doesn't really work)
~~And create file `/etc/modprobe.d/dell-smm-hwmon.conf` with content: `install dell-smm-hwmon /sbin/modprobe -i -f dell-smm-hwmon force=1`~~ (this doesn't really work)

For the first time, the config file in `/etc/fancontrol` generated by pwmconfig is as follows:

```
INTERVAL=10
DEVPATH=hwmon3= 
DEVNAME=hwmon3=dell_smm 
FCTEMPS=hwmon3/pwm2=hwmon3/temp2_input hwmon3/pwm1=hwmon3/temp1_input
FCFANS=hwmon3/pwm2=hwmon3/fan2_input hwmon3/pwm1=hwmon3/fan1_input
MINTEMP=hwmon3/pwm2=45 hwmon3/pwm1=45
MAXTEMP=hwmon3/pwm2=70 hwmon3/pwm1=70 
MINSTART=hwmon3/pwm2=150 hwmon3/pwm1=150 
MINSTOP=hwmon3/pwm2=0 hwmon3/pwm1=0 
MAXPWM=hwmon3/pwm2=255 hwmon3/pwm1=255 
```

The configuration may be lost if `hwmon3` is changed (on reboot), so we replace it with actual path (plus some regex in it)

Because we have run pwmconfig, we known that `hwmon3` is the one we are looking for, we try to find its actual path (which is also a symbolic link)

```
ls /sys/class/hwmon/ -al
```

We notice that its' path is actually "/sys/devices/virtual/hwmon/hwmon3", then we change the config file as follows:

```
INTERVAL=10
FCTEMPS= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=/sys/devices/virtual/hwmon/hwmon[[:print:]]*/temp2_input /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=/sys/devices/virtual/hwmon/hwmon[[:print:]]*/temp1_input
FCFANS= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=/sys/devices/virtual/hwmon/hwmon[[:print:]]*/fan2_input /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=/sys/devices/virtual/hwmon/hwmon[[:print:]]*/fan1_input
MINTEMP= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=45 /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=45
MAXTEMP= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=70 /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=70 
MINSTART= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=150 /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=150 
MINSTOP= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=0 /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=0 
MAXPWM= /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm2=255 /sys/devices/virtual/hwmon/hwmon[[:print:]]*/pwm1=255 
```

To make sure the dell-smm-hwmon module always loaded, we add following line in `/etc/modules`

```
# Generated by sensors-detect on Wed Jan 25 00:32:14 2023
# Chip drivers
coretemp

# the line we added
dell-smm-hwmon force=1
```
